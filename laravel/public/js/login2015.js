function toLogin(){login_click_img(),showModal("logins"),countModalHeight()}function toReg(){reg_click_img(),showModal("signup"),countModalHeight()}function reg_click_img(){$("#reg_captcha_img").attr("src","/captcha/?"+Math.random())}function login_click_img(){$("#login_captcha_img").attr("src","/captcha/?"+Math.random())}function showModal(a){$("body").addClass("hidden"),$("#modal").show(),$("#"+a).show().siblings().hide(),$(".invalid").html("").hide(),$("#"+a).find('input[type="text"]').val(""),$("#"+a).find('input[type="password"]').val(""),$("#login_button").val("登 录").removeClass("loading_btn"),$("#signup_button").val("注 册").removeClass("loading_btn")}function closeModal(){$("body").removeClass("hidden"),$("#modal").hide()}function countModalHeight(){$(".modal-content").each(function(){if($(this).is(":visible")){var a=($(window).height()-$(this).outerHeight())/2;a=0>a?0:a,$(this).css({"margin-top":a+"px"})}})}function checkMobile(a){var b,c=/^1[34578]\d{9}$/;return b=c.test(a)?!0:!1}function checkEmpty(a){return 0==a.length?!1:!0}function foucsInput(a){var b=$(a).attr("id");$('p[for="'+b+'"]').hide()}function checkDetailsBtn(){var a=$.cookie("curType");"leaveMessage"==a&&$(".message").click(),"collect"==a&&$(".collect").click(),"view"==a&&new Boxy("#dialog_form_yuyue",{title:"我要看房"}),"weakpassword"==a&&(oType.val("login"),toLogin()),$.cookie("curType"," ",{expires:7,path:"/"})}function checkHasIn(){var a=$("#r_k").val(),b=$.trim(oSignName.val());checkMobile(b)?$.post("/?_p=sign&_a=register_check_email",{email:b,r_k:a},function(a){"has_in"==a&&($('p[for="sign_name"]').html("手机号已存在").show(),flag=1),"ok"==a&&(flag=0),"error"==a&&($('p[for="sign_name"]').html("验证失败").show(),flag=1)}):$('p[for="sign_name"]').html("请输入正确的手机号").show()}var oUserName,oUserPas,oVerification,oWithinAweek,oLoginButton,countError,is_captcha,oSignName,oSignPas,oSignPasTwo,oSignDuanxin,oSignYzm,oSignBtn,flag,tel_timer,oPasSigBtn,oPasSigName,oPasSigYzm,oType=$("#type");$("#ziroom_login").click(function(){oType.val("login"),toLogin()}),$("#ziroom_reg").click(function(){oType.val("reg"),toReg()}),$("#slideLogin").click(function(){oType.val("login"),toLogin()}),$("#slideWeixiu").click(function(){oType.val("weixiu"),toLogin()}),$("#slidePay").click(function(){oType.val("pay"),toLogin()}),$("#header_collect").click(function(){oType.val("header_collect"),toLogin()}),$("#header_hetong").click(function(){oType.val("header_hetong"),toLogin()}),$(".view").click(function(){oType.val("view")}),$("#reLogin").click(function(){oType.val("reLogin"),toLogin()}),$(window).resize(function(){countModalHeight()}),$(".modal-content .close").click(function(){closeModal()}),$("#within_a_week").attr("checked",!1),$("#within").click(function(){var a=$("#within_a_week").attr("checked");a?($("#within_a_week").attr("checked",!1),$(this).find(".m_icon").removeClass("m_icon_active")):($("#within_a_week").attr("checked",!0),$(this).find(".m_icon").addClass("m_icon_active"))}),$("#reg_refurbish,#reg_captcha_img").click(function(a){reg_click_img(),a.stopPropagation()}),$("#login_refurbish,#login_captcha_img").click(function(a){login_click_img(),a.stopPropagation()}),$("#toSignup").click(function(){toReg()}),$("#toLogin").click(function(){toLogin()}),checkDetailsBtn(),oUserName=$("#user_name"),oUserPas=$("#user_pas"),oVerification=$("#verification"),oWithinAweek=$("#within_a_week"),oLoginButton=$("#login_button"),oUserName.focus(function(){foucsInput(this)}),oUserPas.focus(function(){$("#captcha_tr").is(":visible")&&(login_click_img(),$("#verification").val("")),foucsInput(this)}),oVerification.focus(function(){foucsInput(this)}),$("#logins input").keydown(function(a){13==a.keyCode&&oLoginButton.click()}),countError=$.cookie("countError"),countError||(countError=0,$.cookie("countError",0,{expires:7,path:"/"})),countError>=3?($("#captcha_tr").show(),$.cookie("is_captcha","1",{expires:7,path:"/"})):$.cookie("is_captcha","0",{expires:7,path:"/"}),is_captcha=$.cookie("is_captcha"),is_captcha||(is_captcha=0),oLoginButton.click(function(){function g(){$.post("/?_p=sign&_a=get_hide_key",{},function(g){var h=g;$.post("/?_p=sign&_a=examine",{mphone:b,password:c,captcha:d,hide_key:h,redrect_url:e,within_a_week:f},function(b){var c=oType.val(),d=b.substr(2);return"zwp_success"==b?(window.location="http://s.ziroom.com/index.php?uri=login/",void 0):"oa_login"==b?(window.location="http://z.ziroom.com",void 0):(0==b.indexOf("e")?(a.val("登 录").removeClass("loading_btn").removeAttr("disabled"),(0==d.indexOf("user")||0==d.indexOf("pass"))&&($('p[for="user_pas"]').html("用户名或密码不正确").show(),countError++,$.cookie("countError",countError,{expires:7,path:"/"}),countError>=3&&($("#captcha_tr").show(),$.cookie("is_captcha","1",{expires:7,path:"/"})))):("leaveMessage"==c&&($.cookie("curType","leaveMessage",{expires:7,path:"/"}),closeModal(),window.location.reload()),"collect"==c&&($.cookie("curType","collect",{expires:7,path:"/"}),closeModal(),window.location.reload()),"view"==c&&($.cookie("curType","view",{expires:7,path:"/"}),closeModal(),window.location.reload()),"weixiu"==c&&(window.location.href="/servicecentre/"),"pay"==c&&(window.location.href="http://i.ziroom.com/?uri=contract/pay"),("login"==c||"reg"==c)&&(closeModal(),window.location.reload()),"header_hetong"==c&&(window.location.href="http://i.ziroom.com/?uri=contract/pay"),"header_collect"==c&&(window.location.href="http://i.ziroom.com/?uri=collect"),$.cookie("countError",0,{expires:7,path:"/"})),void 0)})})}var a,b,c,d,e,f;return is_captcha=$.cookie("is_captcha"),a=$(this),b=$.trim(oUserName.val()),c=$.trim(oUserPas.val()),d=$.trim(oVerification.val()),e="",f=$("#within_a_week").attr("checked")?1:0,checkMobile(b)?checkEmpty(c)?checkEmpty(d)||"1"!=is_captcha?(a.val("登录中……").addClass("loading_btn").attr("disabled","disabled"),0!=is_captcha&&"undefine"!=is_captcha?$.ajax({url:"/index.php?_p=sign&_a=captcha",data:"captcha="+d,type:"post",dataType:"json",success:function(b){return b?(login_click_img(),$('p[for="verification"]').html("请输入正确验证码").show(),a.val("登 录").removeClass("loading_btn").removeAttr("disabled"),!1):(g(),void 0)}}):g(),void 0):($('p[for="verification"]').html("请输入正确验证码").show(),void 0):($('p[for="user_pas"]').html("请输入密码").show(),void 0):($('p[for="user_name"]').html("请输入正确的手机号").show(),void 0)}),oSignName=$("#sign_name"),oSignPas=$("#sign_pas"),oSignPasTwo=$("#sign_pas_two"),oSignDuanxin=$("#sign_duanxin"),oSignYzm=$("#sign_yzm"),oSignBtn=$("#signup_button"),flag=0,oSignName.focus(function(){foucsInput(this)}).blur(function(){checkHasIn()}),oSignPas.focus(function(){foucsInput(this)}),oSignPasTwo.focus(function(){foucsInput(this)}),oSignDuanxin.focus(function(){foucsInput(this)}),oSignYzm.focus(function(){foucsInput(this)}),oSignBtn.click(function(){var a=$(this),b=$.trim(oSignName.val()),c=$.trim(oSignPas.val()),d=$("#sign_yzm").val(),e=$("#redrect_url").val(),f=$("#reg_from").val(),g=$.trim(oSignDuanxin.val());return checkMobile($.trim(oSignName.val()))?1==flag?($('p[for="sign_name"]').html("手机号已存在").show(),void 0):checkEmpty(oSignYzm.val())?checkEmpty($.trim(oSignDuanxin.val()))?$.trim(oSignPas.val()).length<6||$.trim(oSignPas.val()).length>16?($('p[for="sign_pas"]').html("请输入6-16号确认密码").show(),void 0):checkEmpty($.trim(oSignPasTwo.val()))?$.trim(oSignPas.val())!=$.trim(oSignPasTwo.val())?($('p[for="sign_pas_two"]').html("密码不一致，请再次确认").show(),void 0):(a.val("提交中……").addClass("loading_btn").attr("disabled","disabled"),$.ajax({type:"POST",url:"/?_p=sign&_a=register_in",data:"email="+b+"&password="+c+"&captcha="+g+"&redrect_url="+e+"&reg_from="+f+"&phone="+b+"&authcode="+d,success:function(b){if("has_in"==b)return $('p[for="sign_name"]').html("手机号已存在").show(),a.val("注 册").removeClass("loading_btn").removeAttr("disabled"),!1;if("e_error"==b)return $('p[for="sign_name"]').html("手机号格式错误").show(),a.val("注 册").removeClass("loading_btn").removeAttr("disabled"),!1;if("c_error"==b)return $('p[for="sign_duanxin"]').html("验证码错误").show(),a.val("注 册").removeClass("loading_btn").removeAttr("disabled"),clearInterval(tel_timer),$("#tel_btn").removeAttr("disabled").css({cursor:"pointer"}).val("获取验证码"),!1;if("success"==b)window.location.href="http://i.ziroom.com/index.php?uri=ziroomer/index";else if("success_redrect"==b)window.location.href=e;else if("failure"==b)return $('p[for="sign_yzm"]').html("注册失败，请重试！").show(),!1}}),void 0):($('p[for="sign_pas_two"]').html("请输入确认密码").show(),void 0):($('p[for="sign_duanxin"]').html("请输入短信验证码").show(),void 0):($('p[for="sign_yzm"]').html("请输入验证码").show(),void 0):($('p[for="sign_name"]').html("请输入正确的手机号").show(),void 0)}),tel_timer=null,$("#tel_btn").click(function(){var a,b,c,d;$('p[for="sign_name"]').html("").hide(),a=$.trim(oSignName.val()),b=$("#r_k").val(),c=$.trim($("#sign_yzm").val()),d=$(this),checkMobile(a)?$.ajax({url:"/?_p=sign&_a=register_check_email",dataType:"html",type:"POST",async:!1,data:{email:a,r_k:b},success:function(b){"ok"==b&&$.ajax({url:"/index.php?_p=sign&_a=captcha",data:"captcha="+c,type:"post",dataType:"json",success:function(b){if(b)return $('p[for="sign_yzm"]').html("请输入正确验证码").show(),!1;$.post("/?_p=sign&_a=send_authcode_new",{email:a,captcha:c},function(){});var e=300;tel_timer=null,d.attr({disabled:!0}).css({cursor:"wait"}),d.val("("+e+")重新发送"),tel_timer=setInterval(function(){e--,d.val("("+e+")重新发送"),0>=e&&(clearInterval(tel_timer),d.removeAttr("disabled").css({cursor:"pointer"}).val("获取验证码"))},1e3)}}),"has_in"==b&&($('p[for="sign_name"]').html("手机号已存在").show(),flag=1),"ok"==b&&(flag=0),"error"==b&&($('p[for="sign_name"]').html("验证失败").show(),flag=1)}}):$('p[for="sign_name"]').html("请输入正确的手机号").show()}),oPasSigBtn=$("#pas_signup_button"),oPasSigName=$("#pas_sign_name"),oPasSigYzm=$("#pas_sign_yzm");